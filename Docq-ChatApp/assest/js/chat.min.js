const mblMenuBtn=document.getElementById("mblMenu"),usersMenu=document.getElementById("users"),userList=document.querySelectorAll("li.user"),msglist=document.getElementById("msglist"),msglistWrap=document.getElementById("msglistwrap"),activeUserID=document.getElementById("activeuserid"),msgTextInput=document.getElementById("msgtextinput"),sendBtn=document.getElementById("sendbtn"),currentUserID=Number(document.getElementById("currentuserid").value);mblMenuBtn.onclick=()=>{usersMenu.classList.toggle("active")};window.onload=()=>{msglist.scrollTop=msglist.scrollHeight};userList.forEach(n=>n.addEventListener("click",()=>{const t=n.getAttribute("data-userid");getMessages(t);document.getElementById("user"+t).classList.remove("unread");var i=document.getElementById("headerusrinfo");i.innerHTML=n.innerHTML}));const getMessages=n=>{usersMenu.classList.remove("active");const t={userid:n},i={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)};fetch("/chatapi.aspx/getmessages",i).then(n=>(n.ok||console.log(`HTTP error! Status: ${n.status}`),n.json())).then(t=>{const i=JSON.parse(t.d);let r="";for(let n=0;n<i.length;n++){let u=Number(i[n].senderid),t=htmlEncode(i[n].content);r+=u===currentUserID?`<div class="message send">
                            <div class="mesaage">
                                ${t}
                            </div>
                        </div>`:`<div class="message recived">
                            <div class="mesaage">
                                ${t}
                            </div>
                        </div>`}msglistWrap.innerHTML=r;activeUserID.value=n;msglist.scrollTop=msglist.scrollHeight}).catch(n=>{console.error("Error:",n)})};$(function(){let n=$.connection.chatHub;n.client.boardcastMessage=function(n,t,i){currentUserID===Number(t)&&(Number($(activeUserID).val())===Number(n)?(msglistWrap.innerHTML+=`<div class="message recived">
                                            <div class="mesaage">
                                                ${htmlEncode(i)}
                                            </div>
                                        </div>`,msglist.scrollTop=msglist.scrollHeight):document.getElementById("user"+n).classList.add("unread"))};msgTextInput.focus();$.connection.hub.start().done(function(){$(sendBtn).click(function(){const t=$(msgTextInput).val();t&&(n.server.send(currentUserID,$(activeUserID).val(),t),msglistWrap.innerHTML+=`<div class="message send">
                                            <div class="mesaage">
                                                ${htmlEncode(t)}
                                            </div>
                                        </div>`,$(msgTextInput).val(""));$(msgTextInput).focus();msglist.scrollTop=msglist.scrollHeight})})});const htmlEncode=n=>{const t=document.createElement("div");return t.innerText=n,t.innerHTML};